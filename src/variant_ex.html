
<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>variant_ex</title>
    <style type="text/css" media="screen">
      html, body, div, span, object, iframe, h1, h2, h3, h4, h5, h6, p,
      blockquote, pre, a, abbr, address, cite, code, del, dfn, em, figure,
      img, ins, kbd, q, s, samp, small, strong, sub, sup, var, b, u, i, dl,
      dt, dd, ol, ul, li, fieldset, form, label, legend, table, caption,
      tbody, tfoot, thead, tr, th, td {
        background: transparent none repeat scroll 0 0;
        border: 0 none;
        font-size: 100%;
        margin: 0;
        outline: 0 none;
        padding: 0;
        vertical-align: baseline;
      }

      .color_red { color: #dc322f; }
      .color_blue { color: #268bd2; }
      .color_green { color: #859901; }
      .color_yellow { color: #b58901; }
      .color_black { color: black; }
      .color_white { color: white; }

      .font_big {
        font-size: 1.2em;
      }

      .ddoc_section_h {
        font-weight: bold;
        font-size: 13px;
        line-height: 19.5px;
        margin-top: 11px;
        display: block;
      }

      body.dlang .dlang {
        display: inline-block;
      }

      body.dlang .declaration .dlang {
          display: block;
      }

      body.dlang .ddoc_header_anchor a.dlang {
        display: block;
        color: rgba(0, 136, 204, 1);
        text-decoration: none;
      }

      body.dlang .ddoc_header_anchor .code {
        color: rgba(0, 136, 204, 1);
      }

      #ddoc_main .module {
          border-color: currentColor rgba(233, 233, 233, 1) rgba(233, 233, 233, 1);
          border-style: none solid solid;
          border-width: 0 1px 1px;
          overflow-x: hidden;
          padding: 15px;
      }

      #ddoc_main .section .section {
        margin-top: 0;
      }

      #ddoc_main .ddoc_module_members_section {
          padding: 1px 0 0;
          transition: transform 0.3s ease 0s;
      }

      #ddoc_main .ddoc_member, #ddoc_main .ddoc_module_members section.intro {
          background: #fff none repeat scroll 0 0;
          list-style-type: none;
          width: 100%;
      }

      #ddoc_main .ddoc_header_anchor {
          font-size: 1.4em;
          transition: transform 0.3s ease 0s;
      }

      #ddoc_main .ddoc_header_anchor > .code {
          display: inline-block;

      }

      #ddoc_main .ddoc_decl {
        background-color: transparent;
        height: 100%;
        left: 0;
        top: 0;
        padding: 0;
        padding-left: 15px;
      }

      #ddoc_main .ddoc_decl .section, #ddoc_main .section.ddoc_sections {
        background: white none repeat scroll 0 0;
        margin: 0;
        padding: 5px;
        position: relative;
        border-radius: 5px;
      }

      #ddoc_main .ddoc_decl .section h4, #ddoc_main .section.ddoc_sections h4 {
        font-size: 13px;
        line-height: 1.5;
        margin-top: 21px;
      }

      #ddoc_main .section .declaration {
          margin-top: 21px;
      }

      #ddoc_main .section .declaration .code {
          color: rgba(0, 0, 0, 1);
          margin-bottom: 15px;
          padding-bottom: 6px;
      }

      #ddoc_main .declaration div .para {
          margin-bottom: 0;
      }

      #ddoc_main .ddoc_params .graybox tr td:first-of-type {
        padding: 7px;
        text-align: right;
        vertical-align: top;
        word-break: normal;
        white-space: nowrap;
      }

      #ddoc_main .ddoc_params .graybox {
        border: 0 none;
      }

      #ddoc_main .ddoc_params .graybox td {
        border-color: rgba(214, 214, 214, 1);
      }

      #ddoc_main .ddoc_params .graybox tr:first-child > td {
        border-top: 0 none;
      }

      #ddoc_main .ddoc_params .graybox tr:last-child > td {
        border-bottom: 0 none;
      }

      #ddoc_main .ddoc_params .graybox tr > td:first-child {
        border-left: 0 none;
      }

      #ddoc_main .ddoc_params .graybox tr > td:last-child {
        border-right: 0 none;
        width: 100%;
      }

      #ddoc_main em.term, #ddoc_main em.term .code {
        color: rgba(65, 65, 65, 1);
        font-size: 12px;
        font-style: italic;
        line-height: 1.5;
      }

      #ddoc_main .see-also {
        cursor: pointer;
        font-family: Menlo,monospace;
      }

      #ddoc_main .ddoc_decl .section > div:last-of-type {
        margin-bottom: 15px;
      }

      #ddoc_main .ddoc_member, #ddoc_main .ddoc_module_members {
          transition: transform 0.3s ease 0s;
      }

      #ddoc_main .code_sample {
        background: inherit;
      }

      #ddoc_main .declaration .code-line {
          display: block;
          font: 1em Menlo,monospace;
      }

      #ddoc_main a[name] {
        margin: -112px 0 0;
        padding-top: 112px;
      }

      #ddoc_main .ddoc_decl td {
        max-width: inherit;
      }

      #ddoc_main .declaration a {
        color: inherit;
      }

      #ddoc_main .declaration a:hover {
          color: rgba(0, 136, 204, 1);
          text-decoration: underline;
      }

      body.ddoc {
        background-color: transparent;
        color: rgba(0, 0, 0, 1);
        font-family: Helvetica,Arial,sans-serif;
        font-size: 62.5%;
        margin: 0;
        border: 0;
        left: 0;
        top: 0;
        padding: 0;
      }

      .ddoc a[name] {
        display: block;
        height: 0;
        margin: -85px 0 0;
        padding-top: 85px;
        width: 0;
      }

      .ddoc .module {
          border-color: transparent;
          background-color: rgba(255, 255, 255, 1);
          border-color: currentColor rgba(233, 233, 233, 1) rgba(233, 233, 233, 1);
          border-image: none;
          border-style: none solid solid;
          border-width: 0 1px 1px;
          box-shadow: 0 0 1px rgba(0, 0, 0, 0.07);
          display: block;
          margin-left: 0;
          min-height: calc(100% - 173px);
          overflow: auto;
          padding-bottom: 100px;
      }

      .ddoc .content_wrapper {
          background-color: rgba(242, 242, 242, 1);
          margin: 0 auto;
          max-width: 980px;
      }

      .ddoc .section {
        padding: 15px 25px 30px;
      }

      .ddoc .section .section {
        margin: 30px 0 0;
        padding: 0;
      }

      .ddoc .para {
        color: rgba(65, 65, 65, 1);
        font-size: 1.4em;
        line-height: 145%;
        margin-bottom: 15px;
      }

      .ddoc .ddoc_examples .para {
        margin-bottom: 0;
      }

      .ddoc .module_name {
          color: rgba(0, 0, 0, 1);
          display: block;
          font-family: Helvetica;
          font-size: 2.8em;
          font-weight: 100;
          margin-bottom: 0;
          padding: 15px 0;
      }

      .ddoc .module a {
          color: rgba(0, 136, 204, 1);
          text-decoration: none;
      }

      .ddoc .code {
        color: rgba(128, 128, 128, 1);
        font-family: Menlo,monospace;
        font-size: 0.85em;
        word-wrap: break-word;
      }

      .ddoc .code i {
        font-style: normal;
      }

      .ddoc .code .code {
        font-size: 1em;
      }

      .ddoc .code_sample {
        background-clip: padding-box;
        margin: 1px 0;
        text-align: left;
      }

      .ddoc .code_sample {
        display: block;
        font-size: 1.4em;
        margin-left: 21px;
      }

      .ddoc ol .code_sample {
        font-size: 1em;
      }

      .ddoc .code_lines {
        counter-reset: li;
        line-height: 1.6em;
        list-style: outside none none;
        margin: 0;
        padding: 0;
      }

      .ddoc .code_listing .code_sample div {
        margin-left: 13px;
        width: 93%;
      }

      .ddoc .code_listing .code_sample div .code_lines li {
        list-style-type: none;
        margin: 0;
        padding-right: 10px;
      }

      .ddoc .code_sample div .code_lines li::before {
        margin-left: -33px;
        margin-right: 25px;
      }

      .ddoc .code_sample div .code_lines li:nth-child(n+10)::before {
        margin-left: -39px;
        margin-right: 25px;
      }

      .ddoc .code_sample div .code_lines li:nth-child(n+100)::before {
        margin-left: -46px;
        margin-right: 25px;
      }

      .ddoc .code_sample .code_lines .code {
        color: #000;
      }

      .ddoc div.dlang {
        margin: 10px 0 21px;
        padding: 4px 0 2px 10px;
      }

      .ddoc div.dlang {
          margin: 10px 0 21px;
          padding: 4px 0 2px 10px;
      }

      .ddoc div.dlang {
        border-left: 5px solid rgba(0, 155, 51, 0.2);
      }

      .ddoc .code_lines li::before {
        color: rgba(128, 128, 128, 1);
        content: counter(li, decimal);
        counter-increment: li;
        font-family: Menlo,monospace;
        font-size: 0.9em;
        margin-right: 16px;
      }

      .ddoc .code_lines li {
        padding-left: 0;
        white-space: pre-wrap;
      }

      .ddoc .code_lines li:only-of-type::before {
        color: rgba(255, 255, 255, 1);
        content: " ";
      }

      .ddoc .code_lines li:only-of-type {
        color: rgba(255, 255, 255, 1);
        content: " ";
      }

      .ddoc .code_lines li:nth-child(n+10) {
        text-indent: -17px;
      }

      .ddoc .code_lines li:nth-child(n+10)::before {
        margin-right: 12px;
      }

      .ddoc .graybox {
        border: 1px solid rgba(233, 233, 233, 1);
        border-collapse: collapse;
        border-spacing: 0;
        empty-cells: hide;
        margin: 20px 0 36px;
        text-align: left;
      }

      .ddoc .graybox p {
        margin: 0;
        min-width: 50px;
      }

      .ddoc td {
        border: 1px solid rgba(233, 233, 233, 1);
        margin: 0;
        max-width: 260px;
        padding: 5px 25px 5px 10px;
        vertical-align: middle;
      }

      .punctuation {
        color: rgba(0, 0, 0, 1);
      }

      .comment {
        color: rgba(0, 131, 18, 1);
      }

      .operator {
        color: #000;
      }

      .keyword {
        color: rgba(170, 13, 145, 1);
      }

      .keyword_type {
        color: rgba(170, 51, 145, 1);
      }

      .string_literal {
        color: rgba(196, 26, 22, 1);
      }

      .ddoc_psuper_symbol {
        color: rgba(92, 38, 153, 1);
      }

      .param {
        color: rgba(0, 0, 0, 1);
      }

      .psymbol {
        color: rgba(0, 0, 0, 1);
      }

      .ddoc_member_header .ddoc_header_anchor .code {
        font-size: 1em;
      }
    </style>
  </head>
  <body id="ddoc_main" class="ddoc dlang">
    <div class="content_wrapper">
      <article class="module">
        <h1 class="module_name">variant_ex</h1>
        <section id="module_content"><section class="section ddoc_sections">
  <div class="ddoc_summary">
  <p class="para">
    Lightweight versions of polymorphism packed inside one single
    word/pointer.

  </p>
</div>
<div class="ddoc_description">
  <h4>Discussion</h4>
  <p class="para">
    Most significant bits are used to store type information.


    These higher bits are normally unused on 64-bit systems (tested on
    Linux). 16 higher bits are, on Linux, either 1 (kernel-space) or 0 (user-space).


    See also: http://forum.dlang.org/post/sybuoliqhhefcovxjfjv@forum.dlang.org


    TODO Ask forum.dlang.org: Is it safe to assume that <code class="code">typeBits</code> most significant bits of a
    pointer are zero? If not put them in least significant part.


    TODO What todo with the fact that the GC will fail to scan WordVariant?
    Can the GC be tweaked to mask out the type bits before scanning?


    TODO Enable support for <code class="code">is null</code> instead of <code class="code">isNull</code>?


    TODO Use <code class="code">enforce()</code> instead of <code class="code">assert()</code> in WordVariant:initialize()


    TODO Move to Phobos std.variant
  </p>
</div>

</section>
<section class="section ddoc_module_members_section">
  <div class="ddoc_module_members">
    <ul class="ddoc_members">
  <li class="ddoc_member">
  <div class="ddoc_member_header">
  <div class="ddoc_header_anchor">
  <a href="#WordVariant" id="WordVariant"><code class="code">WordVariant</code></a>
</div>
</div><div class="ddoc_decl">
  <section class="section">
    <div class="declaration">
      <h4>Declaration</h4>
      <div class="dlang">
        <p class="para">
          <code class="code">
            <span class="ddoc_anchor" id="WordVariant"></span>struct <code class="code">WordVariant</code>(Types...);

          </code>
        </p>
      </div>
    </div>
  </section>
</div>
<div class="ddoc_decl">
  <section class="section ddoc_sections">
  <div class="ddoc_summary">
  <p class="para">
    A variant of <code class="code">Types</code> packed into a word (<code class="code">size_t</code>).

  </p>
</div>
<div class="ddoc_description">
  <h4>Discussion</h4>
  <p class="para">
    Suitable for use in tree-data containers, such as radix trees (tries), where
    hybrid value (sparsely packed sub-tree) and pointer (to dense sub-tree)
    packing of sub-nodes is needed.
  </p>
</div>
<div class="ddoc_examples">
  <h4>Examples</h4>
  <p class="para">
    
<section class="code_listing">
  <div class="code_sample">
    <div class="dlang">
      <ol class="code_lines">
        <li><code class="code"><span class="keyword">import</span> std.meta : AliasSeq;

<span class="keyword">alias</span> SubType = <span class="psymbol">WordVariant</span>!(<span class="keyword">byte</span>*, <span class="keyword">short</span>*);
<span class="keyword">alias</span> SuperType = <span class="psymbol">WordVariant</span>!(<span class="keyword">bool</span>*, <span class="keyword">byte</span>*, <span class="keyword">short</span>*, <span class="keyword">long</span>*);

<span class="keyword">byte</span>* byteValue = <span class="keyword">cast</span>(<span class="keyword">byte</span>*)(0x11);
<span class="keyword">short</span>* shortValue = <span class="keyword">cast</span>(<span class="keyword">short</span>*)(0x22);

SubType sub = byteValue;
<span class="keyword">assert</span>(sub.typeIndex == 1);
<span class="keyword">assert</span>(sub.peek!(<span class="keyword">byte</span>*));
<span class="keyword">assert</span>(*(sub.peek!(<span class="keyword">byte</span>*)) == byteValue);

SuperType sup = sub;
<span class="keyword">assert</span>(sup.typeIndex == 2);
<span class="keyword">assert</span>(sup.peek!(<span class="keyword">byte</span>*));
<span class="keyword">assert</span>(*(sup.peek!(<span class="keyword">byte</span>*)) == byteValue);

sub = shortValue;
<span class="keyword">assert</span>(sub.typeIndex == 2);
<span class="keyword">assert</span>(sub.peek!(<span class="keyword">short</span>*));
<span class="keyword">assert</span>(*(sub.peek!(<span class="keyword">short</span>*)) == shortValue);

sup = sub;
<span class="keyword">assert</span>(sup.typeIndex == 3);
<span class="keyword">assert</span>(sup.peek!(<span class="keyword">short</span>*));
<span class="keyword">assert</span>(*(sup.peek!(<span class="keyword">short</span>*)) == shortValue);
</code></li>
      </ol>
    </div>
  </div>
</section>

  </p>
</div><div class="ddoc_examples">
  <h4>Examples</h4>
  <p class="para">
    
<section class="code_listing">
  <div class="code_sample">
    <div class="dlang">
      <ol class="code_lines">
        <li><code class="code"><span class="keyword">import</span> std.meta : AliasSeq;

<span class="keyword">alias</span> Types = AliasSeq!(<span class="keyword">byte</span>*, <span class="keyword">short</span>*, <span class="keyword">int</span>*, <span class="keyword">long</span>*,
                        <span class="keyword">ubyte</span>*, <span class="keyword">ushort</span>*, <span class="keyword">uint</span>*, <span class="keyword">ulong</span>*,
                        <span class="keyword">float</span>*, <span class="keyword">double</span>*, <span class="keyword">real</span>*,
                        <span class="keyword">char</span>*, <span class="keyword">wchar</span>*, <span class="keyword">dchar</span>*);

<span class="keyword">alias</span> V = <span class="psymbol">WordVariant</span>!Types;
V v;

<span class="keyword">try</span> { <span class="keyword">assert</span>(v.toString == <span class="string_literal">"null"</span>); } <span class="keyword">catch</span> (Exception e) { }

<span class="keyword">assert</span>(v.isNull);
v = <span class="keyword">null</span>;
<span class="keyword">assert</span>(v.isNull);
<span class="keyword">assert</span>(!v);

<span class="keyword">foreach</span> (Tp; Types)
{
    <span class="keyword">alias</span> T = <span class="keyword">typeof</span>(*Tp.init);

    <span class="keyword">static</span> <span class="keyword">assert</span>(!<span class="keyword">__traits</span>(compiles, { T[] a; v = &amp;a; }));
    <span class="keyword">static</span> <span class="keyword">assert</span>(!<span class="keyword">__traits</span>(compiles, { v.peek!(T[]*); }));

    <span class="comment">// assignment from stack pointer
</span>    T a = 73;
    T a_ = 73;

    v = &amp;a;
    <span class="keyword">assert</span>(v);
    <span class="keyword">assert</span>(!v.isNull);
    <span class="keyword">assert</span>(v.typeIndex != 0);
    <span class="keyword">assert</span>(v.isOfType!Tp);

    <span class="keyword">assert</span>(v == &amp;a);
    <span class="keyword">assert</span>(v != &amp;a_);
    <span class="keyword">assert</span>(v);

    <span class="keyword">foreach</span> (Up; Types)
    {
        <span class="keyword">alias</span> U = <span class="keyword">typeof</span>(*Up.init);
        <span class="keyword">static</span> <span class="keyword">if</span> (<span class="keyword">is</span>(T == U))
        {
            <span class="keyword">assert</span>(v.peek!Up);
            <span class="keyword">assert</span>(*(v.peek!Up) == &amp;a);
            <span class="keyword">assert</span>(v.as!Up == &amp;a);
        }
        <span class="keyword">else</span>
        {
            <span class="keyword">assert</span>(!v.peek!Up);
        }
    }

    <span class="comment">// assignment from heap pointer
</span>    T* b = <span class="keyword">new</span> T;
    T* b_ = <span class="keyword">new</span> T;
    *b = 73;
    *b_ = 73;
    v = b;
    <span class="keyword">assert</span>(v == b);
    <span class="keyword">assert</span>(v != b_);
    <span class="keyword">assert</span>(v);
    <span class="keyword">foreach</span> (Up; Types)
    {
        <span class="keyword">alias</span> U = <span class="keyword">typeof</span>(*Up.init);
        <span class="keyword">static</span> <span class="keyword">if</span> (<span class="keyword">is</span>(T == U))
        {
            <span class="keyword">assert</span>(v.peek!Up);
            <span class="keyword">assert</span>(*(v.peek!Up) == b);
        }
        <span class="keyword">else</span>
        {
            <span class="keyword">assert</span>(!v.peek!Up);
        }
    }

}
</code></li>
      </ol>
    </div>
  </div>
</section>

  </p>
</div>
</section>
<ul class="ddoc_members">
  <li class="ddoc_member">
  <div class="ddoc_member_header">
  <div class="ddoc_header_anchor">
  <a href="#WordVariant.canStore" id="WordVariant.canStore"><code class="code">canStore</code></a>
</div>
</div><div class="ddoc_decl">
  <section class="section">
    <div class="declaration">
      <h4>Declaration</h4>
      <div class="dlang">
        <p class="para">
          <code class="code">
            <span class="ddoc_anchor" id="WordVariant.canStore"></span>enum auto <code class="code">canStore</code>(T);

          </code>
        </p>
      </div>
    </div>
  </section>
</div>
<div class="ddoc_decl">
  <section class="section ddoc_sections">
  <div class="ddoc_summary">
  <p class="para">
    Is <code class="code">true</code> iff a <code class="code">T</code> can be stored.
  </p>
</div>

</section>

</div>

</li><li class="ddoc_member">
  <div class="ddoc_member_header">
  <div class="ddoc_header_anchor">
  <a href="#WordVariant.this" id="WordVariant.this"><code class="code">this</code></a>
</div>
</div><div class="ddoc_decl">
  <section class="section">
    <div class="declaration">
      <h4>Declaration</h4>
      <div class="dlang">
        <p class="para">
          <code class="code">
            <span class="ddoc_anchor" id="WordVariant.this"></span>this(T)(T <code class="code">value</code>) if (canStore!T);
<br>
this(typeof(null) <code class="code">value</code>);

          </code>
        </p>
      </div>
    </div>
  </section>
</div>
<div class="ddoc_decl">
  <section class="section ddoc_sections">
  <div class="ddoc_summary">
  <p class="para">
    Construction from <code class="code"><code class="code">value</code></code>.
  </p>
</div>

</section>

</div>

</li><li class="ddoc_member">
  <div class="ddoc_member_header">
  <div class="ddoc_header_anchor">
  <a href="#WordVariant.this" id="WordVariant.this"><code class="code">this</code></a>
</div>
</div><div class="ddoc_decl">
  <section class="section">
    <div class="declaration">
      <h4>Declaration</h4>
      <div class="dlang">
        <p class="para">
          <code class="code">
            <span class="ddoc_anchor" id="WordVariant.this.2"></span>this(SubTypes...)(WordVariant!SubTypes <code class="code">value</code>);

          </code>
        </p>
      </div>
    </div>
  </section>
</div>
<div class="ddoc_decl">
  <section class="section ddoc_sections">
  <div class="ddoc_summary">
  <p class="para">
    Construction from sub-variant <code class="code"><code class="code">value</code></code>.
  </p>
</div>

</section>

</div>

</li><li class="ddoc_member">
  <div class="ddoc_member_header">
  <div class="ddoc_header_anchor">
  <a href="#WordVariant.opAssign" id="WordVariant.opAssign"><code class="code">opAssign</code></a>
</div>
</div><div class="ddoc_decl">
  <section class="section">
    <div class="declaration">
      <h4>Declaration</h4>
      <div class="dlang">
        <p class="para">
          <code class="code">
            <span class="ddoc_anchor" id="WordVariant.opAssign"></span>ref auto <code class="code">opAssign</code>(typeof(this) <code class="code">value</code>);
<br>
ref auto <code class="code">opAssign</code>(T)(T <code class="code">that</code>) if (canStore!T);
<br>
ref auto <code class="code">opAssign</code>(typeof(null) <code class="code">that</code>);

          </code>
        </p>
      </div>
    </div>
  </section>
</div>
<div class="ddoc_decl">
  <section class="section ddoc_sections">
  <div class="ddoc_summary">
  <p class="para">
    Assignment from <code class="code"><code class="code">that</code></code>.
  </p>
</div>

</section>

</div>

</li><li class="ddoc_member">
  <div class="ddoc_member_header">
  <div class="ddoc_header_anchor">
  <a href="#WordVariant.opAssign" id="WordVariant.opAssign"><code class="code">opAssign</code></a>
</div>
</div><div class="ddoc_decl">
  <section class="section">
    <div class="declaration">
      <h4>Declaration</h4>
      <div class="dlang">
        <p class="para">
          <code class="code">
            <span class="ddoc_anchor" id="WordVariant.opAssign.2"></span>ref auto <code class="code">opAssign</code>(SubTypes...)(WordVariant!SubTypes <code class="code">value</code>);

          </code>
        </p>
      </div>
    </div>
  </section>
</div>
<div class="ddoc_decl">
  <section class="section ddoc_sections">
  <div class="ddoc_summary">
  <p class="para">
    Assignment from sub-variant <code class="code"><code class="code">value</code></code>.
  </p>
</div>

</section>

</div>

</li><li class="ddoc_member">
  <div class="ddoc_member_header">
  <div class="ddoc_header_anchor">
  <a href="#WordVariant.typeIx" id="WordVariant.typeIx"><code class="code">typeIx</code></a>
</div>
</div><div class="ddoc_decl">
  <section class="section">
    <div class="declaration">
      <h4>Declaration</h4>
      <div class="dlang">
        <p class="para">
          <code class="code">
            <span class="ddoc_anchor" id="WordVariant.typeIx"></span>const Ix <code class="code">typeIx</code>();

          </code>
        </p>
      </div>
    </div>
  </section>
</div>
<div class="ddoc_decl">
  <section class="section ddoc_sections">
  <div class="ddoc_summary">
  <p class="para">
    Get zero-offset index as <code class="code">Ix</code> of current variant type.
  </p>
</div>

</section>

</div>

</li>
</ul>

</div>

</li><li class="ddoc_member">
  <div class="ddoc_member_header">
  <div class="ddoc_header_anchor">
  <a href="#VariantPointerTo" id="VariantPointerTo"><code class="code">VariantPointerTo</code></a>
</div>
</div><div class="ddoc_decl">
  <section class="section">
    <div class="declaration">
      <h4>Declaration</h4>
      <div class="dlang">
        <p class="para">
          <code class="code">
            <span class="ddoc_anchor" id="VariantPointerTo"></span>struct <code class="code">VariantPointerTo</code>(Types...);

          </code>
        </p>
      </div>
    </div>
  </section>
</div>
<div class="ddoc_decl">
  <section class="section ddoc_sections">
  <div class="ddoc_summary">
  <p class="para">
    A typed pointer to a variant of <code class="code">Types</code>, packed into a word (<code class="code">size_t</code>).
    See also: <code class="code">std.bitmanip.taggedPointer</code>.
  </p>
</div>
<div class="ddoc_examples">
  <h4>Examples</h4>
  <p class="para">
    
<section class="code_listing">
  <div class="code_sample">
    <div class="dlang">
      <ol class="code_lines">
        <li><code class="code"><span class="keyword">import</span> std.meta : AliasSeq;

<span class="keyword">alias</span> Types = AliasSeq!(<span class="keyword">byte</span>, <span class="keyword">short</span>, <span class="keyword">int</span>, <span class="keyword">long</span>,
                        <span class="keyword">ubyte</span>, <span class="keyword">ushort</span>, <span class="keyword">uint</span>, <span class="keyword">ulong</span>,
                        <span class="keyword">float</span>, <span class="keyword">double</span>, <span class="keyword">real</span>,
                        <span class="keyword">char</span>, <span class="keyword">wchar</span>, <span class="keyword">dchar</span>);

<span class="keyword">alias</span> V = <span class="psymbol">VariantPointerTo</span>!Types;

V v;
<span class="keyword">assert</span>(v.isNull);
v = <span class="keyword">null</span>;
<span class="keyword">assert</span>(v.isNull);
<span class="keyword">assert</span>(!v);

<span class="keyword">foreach</span> (T; Types)
{
    <span class="keyword">static</span> <span class="keyword">assert</span>(!<span class="keyword">__traits</span>(compiles, { T[] a; v = &amp;a; }));
    <span class="keyword">static</span> <span class="keyword">assert</span>(!<span class="keyword">__traits</span>(compiles, { v.peek!(T[]*); }));

    <span class="comment">// assignment from stack pointer
</span>    T a = 73;
    T a_ = 73;
    v = &amp;a;
    <span class="keyword">assert</span>(v == &amp;a);
    <span class="keyword">assert</span>(v != &amp;a_);
    <span class="keyword">assert</span>(v);
    <span class="keyword">foreach</span> (U; Types)
    {
        <span class="keyword">static</span> <span class="keyword">if</span> (<span class="keyword">is</span>(T == U))
        {
            <span class="keyword">assert</span>(v.peek!U);
            <span class="keyword">assert</span>(*(v.peek!U) == a);
        }
        <span class="keyword">else</span>
        {
            <span class="keyword">assert</span>(!v.peek!U);
        }
    }

    <span class="comment">// assignment from heap pointer
</span>    T* b = <span class="keyword">new</span> T;
    T* b_ = <span class="keyword">new</span> T;
    *b = 73;
    *b_ = 73;
    v = b;
    <span class="keyword">assert</span>(v == b);
    <span class="keyword">assert</span>(v != b_);
    <span class="keyword">assert</span>(v);
    <span class="keyword">foreach</span> (U; Types)
    {
        <span class="keyword">static</span> <span class="keyword">if</span> (<span class="keyword">is</span>(T == U))
        {
            <span class="keyword">assert</span>(v.peek!U);
            <span class="keyword">assert</span>(*(v.peek!U) == *b);
        }
        <span class="keyword">else</span>
        {
            <span class="keyword">assert</span>(!v.peek!U);
        }
    }

}
</code></li>
      </ol>
    </div>
  </div>
</section>

  </p>
</div>
</section>
<ul class="ddoc_members">
  <li class="ddoc_member">
  <div class="ddoc_member_header">
  <div class="ddoc_header_anchor">
  <a href="#VariantPointerTo.canStorePointerTo" id="VariantPointerTo.canStorePointerTo"><code class="code">canStorePointerTo</code></a>
</div>
</div><div class="ddoc_decl">
  <section class="section">
    <div class="declaration">
      <h4>Declaration</h4>
      <div class="dlang">
        <p class="para">
          <code class="code">
            <span class="ddoc_anchor" id="VariantPointerTo.canStorePointerTo"></span>enum auto <code class="code">canStorePointerTo</code>(T);

          </code>
        </p>
      </div>
    </div>
  </section>
</div>
<div class="ddoc_decl">
  <section class="section ddoc_sections">
  <div class="ddoc_summary">
  <p class="para">
    Is <code class="code">true</code> iff a pointer to a <code class="code">T</code> can be stored.
  </p>
</div>

</section>

</div>

</li><li class="ddoc_member">
  <div class="ddoc_member_header">
  <div class="ddoc_header_anchor">
  <a href="#VariantPointerTo.this" id="VariantPointerTo.this"><code class="code">this</code></a>
</div>
</div><div class="ddoc_decl">
  <section class="section">
    <div class="declaration">
      <h4>Declaration</h4>
      <div class="dlang">
        <p class="para">
          <code class="code">
            <span class="ddoc_anchor" id="VariantPointerTo.this"></span>this(T)(T* <code class="code">value</code>) if (canStorePointerTo!T);
<br>
this(typeof(null) <code class="code">value</code>);

          </code>
        </p>
      </div>
    </div>
  </section>
</div>
<div class="ddoc_decl">
  <section class="section ddoc_sections">
  <div class="ddoc_summary">
  <p class="para">
    Construction from <code class="code"><code class="code">value</code></code>.
  </p>
</div>

</section>

</div>

</li><li class="ddoc_member">
  <div class="ddoc_member_header">
  <div class="ddoc_header_anchor">
  <a href="#VariantPointerTo.opAssign" id="VariantPointerTo.opAssign"><code class="code">opAssign</code></a>
</div>
</div><div class="ddoc_decl">
  <section class="section">
    <div class="declaration">
      <h4>Declaration</h4>
      <div class="dlang">
        <p class="para">
          <code class="code">
            <span class="ddoc_anchor" id="VariantPointerTo.opAssign"></span>ref auto <code class="code">opAssign</code>(T)(T* <code class="code">that</code>) if (canStorePointerTo!T);
<br>
ref auto <code class="code">opAssign</code>(typeof(null) <code class="code">that</code>);

          </code>
        </p>
      </div>
    </div>
  </section>
</div>
<div class="ddoc_decl">
  <section class="section ddoc_sections">
  <div class="ddoc_summary">
  <p class="para">
    Assignment from <code class="code"><code class="code">that</code></code>.
  </p>
</div>

</section>

</div>

</li>
</ul>

</div>

</li>
</ul>
  </div>
</section>
</section>
      </article>
    </div>
  </body>
</html>
